/*
var userId= getIdFromURL("userId");
var chosenType = '';

$(document).ready(function() {
	$("#fb_district_admin_checkbox").change(function() {
		if ($(this).prop("checked")) {
			$("#select_multiple_district_div").show();
			$("#select_multiple_district").attr("multiple", "multiple");
			loadDistricts();
		} else {
			$("#select_multiple_district_div").hide();
		}
	});

	$("#fb_campus_admin_checkbox").change(function() {
		if ($(this).prop("checked")) {
			$("#select_multiple_school_div").show();
			$("#select_multiple_school").attr("multiple", "multiple");
			loadAllSchoolListByDistrict();
		} else {
			$("#select_multiple_school_div").hide();
		}
	});

    $("#btn_reset_dropdown").click(function(){
       $("#select_multiple_district").val('').trigger("change");
       $("#select_multiple_school").val('').trigger("change");
    });

    $("#btn_save_roles").click(function(){
        saveRoles();
    });

    $("#btn_add_role").click(function(){
        $("#modal_add_role").modal("show");
        //loadFBUserDefinedRoles();
        //loadFBPreDefinedRoles();
        $("#select_multiple_district option:selected").prop("selected", false);
        */
/*$("#select_multiple_district option:selected").prop("selected", false);
        $("#select_multiple_district_div").hide()
        $("#select_multiple_school option:selected").prop("selected", false);
        $("#select_multiple_school_div").hide()
        $("#select_multiple_school_div").hide()*//*

    });

});

function loadFBUserDefinedRoles() {
    $(".mdl-add-role-loader").show();
       requestAjaxEngine({
           "url": "readFBUserdefinedRoles",
           'type': 'POST',
           'data': {},
           'callbackMethod': loadFBUserDefinedRolesHandler
       });
}

function loadFBUserDefinedRolesHandler(data){
    $(".mdl-add-role-loader").hide();
    if(data.status == STATUS_SUCCESS) {
        var htm ='';
       if(data.aclRoleVOList.length > 0) {
           $.each(data.aclRoleVOList, function (i, role) {
               htm += constructRoleSelection(role, "user-defined-checkbox");
           });
           $("#user_defined_role_div").html(htm);
           initAclRoleSelection(data, false);
       } else {
            htm = '<div class="pd-10-f tx-11-f tx-gray-700 wd-100p text-center tx-medium"><i class="ion ion-ios-megaphone mg-r-5 tx-15-f"></i> No system role found.</div>';
            $("#user_defined_role_div").html(htm);
       }
    }else {
           _manageErrorMessage("#modal_add_role_error", "#modal_add_role_error_text", data.errorMessage);
    }
}

function loadFBPreDefinedRoles() {
    $(".mdl-add-role-loader").show();
       requestAjaxEngine({
           "url": "readFBPredefinedRoles",
           'type': 'POST',
           'data': {},
           'callbackMethod': loadFBPreDefinedRolesHandler
       });
}

function loadFBPreDefinedRolesHandler(data){
    $(".mdl-add-role-loader").hide();
    if(data.status == STATUS_SUCCESS) {
        var htm ='';
       if(data.aclRoleVOList.length > 0) {
           $.each(data.aclRoleVOList, function (i, role) {
               htm += constructRoleSelection(role, "pre-defined-checkbox");
               $("#pre_defined_role_div").html(htm);
           });
           initAclRoleSelection(data, true);
       }else {
            htm = '<div class="pd-10-f tx-11-f tx-gray-700 wd-100p text-center tx-medium"><i class="ion ion-ios-megaphone mg-r-5 tx-15-f"></i> No system role found.</div>';
            $("#pre_defined_role_div").html(htm);
       }
    }else {
           _manageErrorMessage("#modal_add_role_error", "#modal_add_role_error_text", data.errorMessage);
    }
}

function roleListData(){
    var roleArray = [] ;
    $(".roles-checkbox").each(function(){
        if($(this).prop("checked")) {
            var dist_ids = $("#select_multiple_district").val();
            var school_ids = $("#select_multiple_school").val()
            var featureId = [];

            $.each(dist_ids, function(i, v) {
                featureId.push({
                    featureId: v
                })
            })

            $.each(school_ids, function(i, v) {
                featureId.push({
                    featureId: v
                })
            })

            var roleIds = {
                            "roleId": $(this).attr('id'),
                            "aclFeatureVOs": featureId
                          };

            roleArray.push(roleIds);
        }
    });
    return roleArray;
}

function saveRoles() {
    $(".mdl-add-role-loader").show();

    requestData = {"userVO":{"userId":userId},
                    "roleVOList":roleListData()
                  };
       requestAjaxEngine({
           "url": "saveUserACLRole",
           'type': 'POST',
           'data': requestData,
           'callbackMethod': saveRolesHandler
       });
}

function saveRolesHandler(data){
    $(".mdl-add-role-loader").hide();
    window.scrollTo(0, 0);
    if(data.status == STATUS_SUCCESS) {
        _manageSuccessMessage("#modal_add_role_success", "#modal_add_role_success_text", "Role created successfully." );
        setTimeout(function(){ $("#modal_add_role").modal("hide"), loadFBAdminUser(userId, false);}, 3000);
    }  else {
        _manageErrorMessage("#modal_add_role_error", "#modal_add_role_error_text", data.errorMessage);
    }
}

$(document).on('change', '.roles-checkbox', function(){
    var isFbAdminPresent = false;
    if ($(this).attr("data-value") == "FB_ADMIN" && $(this).is(":checked")) {
        $(".roles-checkbox").each(function(){
            if ($(this).attr("data-value") != "FB_ADMIN") {
                //$(this).prop("checked", false);
                $(this).prop("disabled", false);
            } else if ($(this).is(":checked"))
                isFbAdminPresent = true;
        });
    }
    $(".roles-checkbox").each(function(){
        if ($(this).attr("data-value") == "FB_ADMIN" && $(this).is(":checked"))
            isFbAdminPresent = true;
    });

    if ($(this).attr("data-value") == "FB_ADMIN" && !$(this).is(":checked") && !isFbAdminPresent)
        $(".roles-checkbox").prop("disabled", false);

});

$(document).on('change', '.pre-defined-checkbox', function(){
    if($(this).prop('checked')){
        if($(this).attr("data-value") == "DISTRICT_ADMIN" || $(this).attr("data-value") == "SCHOOL_ADMIN"){
            chosenType = $(this).attr("data-value");
            loadSpecializationFeatureList($(this).attr("data-id"),$(this).attr("data-value"))
            $(this).attr("data-value") == 'SCHOOL_ADMIN' ? $("#select_multiple_school_div").show() : $("#select_multiple_district_div").show();
        }
    } else {
        if ($(this).attr("data-value") == "DISTRICT_ADMIN"){
            $("#select_multiple_district option:selected").prop("selected", false);
            $("#select_multiple_district_div").hide()
        } else if($(this).attr("data-value") == "SCHOOL_ADMIN"){
            $("#select_multiple_school option:selected").prop("selected", false);
            $("#select_multiple_school_div").hide()
        }
    }
});

function loadSpecializationFeatureList(id,type){
    $(".mdl-add-role-loader").show();
    var requestData = {"specializationId": id};
    if(type == "DISTRICT_ADMIN")
        requestData['featureTypes'] = ["DISTRICT"];
    if(type == "SCHOOL_ADMIN")
        requestData['featureTypes'] = ["SCHOOL"];
    requestAjaxEngine({
        "url": "loadFeatureBySpecialization",
        'type': 'POST',
        'data': requestData,
        'callbackMethod': loadSpecializationFeatureListHandler
    });
}

function loadSpecializationFeatureListHandler(data){
    $(".mdl-add-role-loader").hide();
    if(data.status == STATUS_SUCCESS) {
       if(data.lstFeatureBySpecialization != undefined && data.lstFeatureBySpecialization != null && data.lstFeatureBySpecialization.length > 0) {
           var selectMultipleSchoolHtm = "", selectMultipleDistrictHtm = "";
           if (chosenType === 'DISTRICT_ADMIN') {
                $("#select_multiple_district").html('');
           } else if (chosenType === 'SCHOOL_ADMIN') {
                $("#select_multiple_school").html('');
           }
           $.each(data.lstFeatureBySpecialization, function (i, feature) {
              if (feature.featureType == "SCHOOL") {
                  selectMultipleSchoolHtm += constructSchoolMultiselect(feature);
                  $("#select_multiple_school_div").html(selectMultipleSchoolHtm);
                  $("#select_multiple_school").append('<option value="'+feature.featureId+'">'+feature.featureName+'</option>');
              } else {
                $("#select_multiple_district").append('<option value="'+feature.featureId+'">'+feature.featureName+'</option>');
              }
           });
       }
       $("#select_multiple_district").select2({placeholder: "Select District"});
       $("#select_multiple_school").select2({placeholder: "Select School"});
    } else {
        _manageErrorMessage("#modal_add_role_error", "#modal_add_role_error_text", data.errorMessage);
    }
}

function constructRoleSelection(role, checkboxType) {
    return '<div class="col-md-2-4 form-check">'+
               '<label class="ckbox mg-t-10-f mg-l-20 chkbx-custom">'+
               '<input type="checkbox" class="roles-checkbox '+checkboxType+'" data-id="'+role.aclSpecializationVO.aclSpecializationId+'" data-value="'+role.aclSpecializationVO.aclSpecializationKey+'" id="'+role.roleId+'"><span data-toggle="tooltip" data-placement="top" title="" data-original-title="'+role.roleName+'">'+stringSubHandleLength(role.roleName,15)+'</span> </label>'+
           '</div>';
}

function initAclRoleSelection(data, isTrigger) {
    $.each(data.aclRoleVOList, function (i, role) {
       renderSelectedAclRole(role, isTrigger);
    });
}

function renderSelectedAclRole(role, isTrigger) {
    if(isTrigger)
        $("#"+role.roleId).prop("checked", checkIfRoleExists(role.roleId)).trigger("change");
    else
        $("#"+role.roleId).prop("checked", checkIfRoleExists(role.roleId));
}

function checkIfRoleExists(roleId) {
    var htm = false
    $(".div-selected-roles").each(function(){
        if($(this).attr("data-id") == roleId)
            htm = true;
    });
    return htm;
}

function constructSchoolMultiselect(feature) {
      return    '<div class="mg-t-10-f d-none" id="select_multiple_school_div_'+feature.featureId+'">'+
                    '<h6 class="tx-normal tx-gray-600">Schools</h6>'+
                    '<div class="row">'+
                        '<div class="col-md-12">'+
                            '<div class="form-group">'+
                                '<select id="select_multiple_school_'+feature.featureId+'" name="select_multiple_school_'+feature.featureId+'" class="form-control select2-no-search" multiple="multiple">'+
                                    '<option value="'+feature.featureId+'">'+feature.featureName+'</option>'+
                                '</select>'+
                                '<span id="select_district_'+feature.featureId+'_error"></span>'+
                            '</div>'+
                        '</div>'+
                    '</div>'+
                '</div>';
    //return $("#select_multiple_school").append('<option value="'+feature.featureId+'">'+feature.featureName+'</option>');
}*/

